@model HumanResourceManagement.Models.NhanVienViewModel

@{
    ViewBag.Title = "NhanVien";
    Layout = "~/Views/Shared/_LayoutAdmin.cshtml";
}

<head>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="~/Content/Css/styleNV.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet">
    <!-- Thêm jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <!-- Thêm jQuery UI -->
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <title>HOÀNG DIỆU SCHOOL</title>
</head>
<section class="main-section">
    <div class="Tieude">
        <h2>Danh sách nhân viên</h2>
        <div class="right-tools">
            <button class="loc">
                <img src="~/Content/img/Vectorloc.png" alt="loc" class="icon-nav">
            </button>
            <button class="Them" id="openPanel">
                Thêm
                <img src="~/Content/img/Vectorthem.png" alt="icon-them">
            </button>

        </div>
    </div>
    <div class="tableds">
        <table class="table table-hover">
            <thead class="truong">
                <tr>
                    <th scope="col">Mã nhân viên</th>
                    <th scope="col">Họ và tên</th>
                    <th scope="col">Trực thuộc phòng ban</th>
                    <th scope="col">Trình độ</th>
                    <th scope="col">Chức vụ</th>
                    @*<th scope="col">CCCD</th>*@
                    @*<th scope="col">Ngày sinh</th>
                    <th scope="col">Giới tính</th>
                    <th scope="col">Địa chỉ</th>*@
                    @*<th scope="col">Email</th>
                    <th scope="col">Số điện thoại</th>
                    <th scope="col">Ngày bắt đầu</th>
                    <th scope="col">Tên tài khoản</th>*@
                </tr>

            </thead>

            @foreach (var nv in Model.DanhSachNhanVien)
            {

                <tr>
                    <td>@nv.MaNhanVien</td>
                    <td>@nv.HoTen</td>
                    <td>
                        @* Tìm Phòng ban dựa trên MaPhongBan *@
                        @* Dùng LINQ để tìm tên Phòng ban dựa trên mã *@
                        @{
                            var phongBan = Model.PhongBanList.FirstOrDefault(p => p.Value == nv.MaPhongBan.ToString());
                        }
                        @phongBan.Text
                    </td>
                    <td>
                        @* Tìm Trình độ dựa trên MaTrinhDo *@
                        @{
                            var trinhDo = Model.TrinhDoList.FirstOrDefault(t => t.Value == nv.MaTrinhDo.ToString());
                        }
                        @trinhDo.Text
                    </td>
                    <td>
                        @* Tìm Chức vụ dựa trên MaChucVu *@
                        @{
                            var chucVu = Model.ChucVuList.FirstOrDefault(c => c.Value == nv.MaChucVu.ToString());
                        }
                        @chucVu.Text
                    </td>
                    @*<td>@nv.CCCD</td>
                    <td>@nv.NgaySinh.Value.ToString("d/M/yyyy")</td>
                    <td>@nv.GioiTinh</td>
                    <td>@nv.DiaChi</td>*@
                    @*<td>@nv.Email</td>
        <td>@nv.SoDienThoai</td>
        <td>@nv.NgayBatDauLam.Value.ToString("d/M/yyyy")</td>
        <td>@nv.TenTaiKhoan</td>*@
                    <td>
                        <span class="three-dots" onclick="toggleDropdown(event)">
                            <img src="/Content/img/ri_more-2-fill.png" alt="3-dot" class="icon-dot">
                        </span>
                        <ul class="dropdown-menu" style="display: none;">
                            <li>
                                <a href="#" class="edit-option" data-id="@nv.MaNhanVien" onclick="openEditPanel(@nv.MaNhanVien)">
                                    <span>Sửa</span>
                                </a>
                            </li>
                            <li>
                                <a href="#" class="delete-option" onclick="deleteNhanVien(@nv.MaNhanVien)">
                                    <span>Xóa</span>
                                </a>
                            </li>
                        </ul>
                    </td>
                </tr>
            }
        </table>
    </div>
    <nav aria-label="Page navigation example">
        <ul class="pagination justify-content-end">
            <li class="page-item disabled">
                <a class="page-link">Previous</a>
            </li>
            <li class="page-item"><a class="page-link" href="#">1</a></li>
            <li class="page-item"><a class="page-link" href="#">2</a></li>
            <li class="page-item"><a class="page-link" href="#">3</a></li>
            <li class="page-item">
                <a class="page-link" href="#">Next</a>
            </li>
        </ul>
    </nav>
</section>
<aside class="right-panel" id="rightPanel">
    <div class="panel-header d-flex justify-content-between align-items-center">
        <h3>Thêm thông tin</h3>
        <button id="closePanel" type="button" class="btn-close" aria-label="Close">
            <i class="fas fa-times"></i>
        </button>
    </div>
    <form class="panel-content" method="post" action="/Nhanvien/AddNhanVien">
        <div class="row g-3 flex-column">
            <div class="col">
                <input type="text" name="NhanVienMoi.MaNhanVien" class="form-control" placeholder="Mã nhân viên" required>
            </div>
            <div class="col">
                <input type="text" name="NhanVienMoi.HoTen" class="form-control" placeholder="Họ và tên" required>
            </div>
            <div class="col">
                <select name="NhanVienMoi.MaPhongBan" class="form-select">
                    @if (Model.PhongBanList != null && Model.PhongBanList.Any())  
                    {
                        foreach (var phongBan in Model.PhongBanList)
                        {
                            <option value="@phongBan.Value">@phongBan.Text</option>
                        }
                    }
                    else
                    {
                        <option disabled>Không có phòng ban</option>
                    }
                </select>
            </div>
            <div class="col">
                <select name="NhanVienMoi.MaTrinhDo" class="form-select">
                    @if (Model.TrinhDoList != null && Model.TrinhDoList.Any())
                    {
                        foreach (var trinhDo in Model.TrinhDoList)
                        {
                            <option value="@trinhDo.Value">@trinhDo.Text</option>
                        }
                    }
                    else
                    {
                        <option disabled>Không có trình độ</option>
                    }
                </select>
            </div>
            <div class="col">
                <select name="NhanVienMoi.MaChucVu" class="form-select">
                    @if (Model.ChucVuList != null && Model.ChucVuList.Any())
                    {
                        foreach (var chucVu in Model.ChucVuList)
                        {
                            <option value="@chucVu.Value">@chucVu.Text</option>
                        }
                    }
                    else
                    {
                        <option disabled>Không có Chức vụ</option>
                    }
                </select>
            </div>
            <div class="col">
                <input type="text" name="NhanVienMoi.CCCD" class="form-control" placeholder="CCCD">
            </div>
            <div class="col input-with-icon">
                <input type="date" name="NhanVienMoi.NgaySinh" class="form-control" placeholder="Ngày sinh">
            </div>
            <div class="col">
                <select name="NhanVienMoi.GioiTinh" class="form-select">
                    <option selected>Giới tính</option>
                    <option value="1">Nam</option>
                    <option value="2">Nữ</option>
                    <option value="3">Khác</option>
                </select>
            </div>
            <div class="col">
                <input type="text" name="NhanVienMoi.DiaChi" class="form-control" placeholder="Địa chỉ">
            </div>
            <div class="col">
                <input type="text" name="NhanVienMoi.Email" class="form-control" placeholder="Email">
            </div>
            <div class="col">
                <input type="text" name="NhanVienMoi.SoDienThoai" class="form-control" placeholder="Số điện thoại">
            </div>
            <div class="col input-with-icon">
                <input type="date" name="NhanVienMoi.NgayBatDauLam" class="form-control" placeholder="Ngày bắt đầu làm">
            </div>
            <div class="col">
                <input type="text" name="NhanVienMoi.TenTaiKhoan" class="form-control" placeholder="Tên Tài Khoản">
            </div>
        </div>
        <div class="panel-footer d-flex justify-content-between">
            <button type="submit" class="btn btn-save">Lưu<i class="fas fa-save icon-btn"></i></button>
        </div>
    </form>
</aside>
<aside class="right-panel" id="rightPanel">
    <div class="panel-header d-flex justify-content-between align-items-center">

        <h3>Cập nhật thông tin</h3>
        <button id="closePanel" type="button" class="btn-close" aria-label="Close">
            <i class="fas fa-times"></i>
        </button>
    </div>
    <form class="panel-content" method="post" action="/Nhanvien/UpdateNhanVien">
        <div class="row g-3 flex-column">
            <div class="col">
                <input type="hidden" name="NhanVienUpdate.MaNhanVien" id="updateMaNhanVien" class="form-control" placeholder="Mã nhân viên" required>
            </div>
            <div class="col">
                <input type="text" name="NhanVienUpdate.HoTen" id="updateHoTen" class="form-control" placeholder="Họ và tên" required>
            </div>
            <div class="col">
                <select name="NhanVienUpdate.MaPhongBan" id="updateMaPhongBan"  class="form-select">
                    @if (Model.PhongBanList != null && Model.PhongBanList.Any())
                    {
                        foreach (var phongBan in Model.PhongBanList)
                        {
                            <option value="@phongBan.Value">@phongBan.Text</option>
                        }
                    }
                    else
                    {
                        <option disabled>Không có phòng ban</option>
                    }
                </select>
            </div>
            <div class="col">
                <select name="NhanVienUpdate.MaTrinhDo" id="updateMaTrinhDo" class="form-select">
                    @if (Model.TrinhDoList != null && Model.TrinhDoList.Any())
                    {
                        foreach (var trinhDo in Model.TrinhDoList)
                        {
                            <option value="@trinhDo.Value">@trinhDo.Text</option>
                        }
                    }
                    else
                    {
                        <option disabled>Không có trình độ</option>
                    }
                </select>
            </div>
            <div class="col">
                <select name="NhanVienUpdate.MaChucVu" id="updateMaChucVu" class="form-select">
                    @if (Model.ChucVuList != null && Model.ChucVuList.Any())
                    {
                        foreach (var chucVu in Model.ChucVuList)
                        {
                            <option value="@chucVu.Value">@chucVu.Text</option>
                        }
                    }
                    else
                    {
                        <option disabled>Không có Chức vụ</option>
                    }
                </select>
            </div>
            <div class="col">
                <input type="text" name="NhanVienUpdate.CCCD" id="updateCCCD" class="form-control" placeholder="CCCD">
            </div>
            <div class="col input-with-icon">
                <input type="date" name="NhanVienUpdate.NgaySinh" id="updateNgaySinh" class="form-control" placeholder="Ngày sinh">
            </div>
            <div class="col">
                <select name="NhanVienUpdate.GioiTinh" id="updateGioiTinh" class="form-select">
                    <option selected>Giới tính</option>
                    <option value="1">Nam</option>
                    <option value="2">Nữ</option>
                    <option value="3">Khác</option>
                </select>
            </div>
            <div class="col">
                <input type="text" name="NhanVienUpdate.DiaChi" id="updateDiaChi" class="form-control" placeholder="Địa chỉ">
            </div>
            <div class="col">
                <input type="email" name="NhanVienUpdate.Email" id="updateEmail" class="form-control" placeholder="Email">
            </div>
            <div class="col">
                <input type="text" name="NhanVienUpdate.SoDienThoai" id="updateSoDienThoai" class="form-control" placeholder="Số điện thoại">
            </div>
            <div class="col input-with-icon">
                <input type="date" name="NhanVienUpdate.NgayBatDauLam" id="updateNgayBatDauLam" class="form-control" placeholder="Ngày bắt đầu làm">
            </div>
            <div class="col">
                <input type="text"  name="NhanVienUpdate.TenTaiKhoan" id="updateTenTaiKhoan" class="form-control" placeholder="Tên Tài Khoản">
            </div>
        </div>
        <div class="panel-footer d-flex justify-content-between">
            <button type="submit" class="btn btn-save">Lưu<i class="fas fa-save icon-btn"></i></button>
        </div>
    </form>
</aside>
<script>

    //const data = [
    //    { name: "Trần Lan Nhi", department: "Khoa ngoại ngữ", position: "Trưởng khoa", status: "Đang làm" },
    //    { name: "Nguyễn Lan", department: "Khoa Tin học", position: "Giảng viên", status: "Đang làm" }

    //];

    //// Hàm để tạo bảng dữ liệu động
    //function renderTable(data) {
    //    const tableBody = document.getElementById('table-body');
    //    tableBody.innerHTML = '';


    //    if (data.length === 0) {
    //        tableBody.innerHTML = '<tr><td colspan="5">Không có dữ liệu</td></tr>';
    //    } else {

    //        for (let i = 0; i < data.length; i++) {
    //            const row = document.createElement('tr');

    //            const cell1 = document.createElement('td');
    //            cell1.textContent = data[i].name;
    //            row.appendChild(cell1);

    //            const cell2 = document.createElement('td');
    //            cell2.textContent = data[i].department;
    //            row.appendChild(cell2);

    //            const cell3 = document.createElement('td');
    //            cell3.textContent = data[i].position;
    //            row.appendChild(cell3);

    //            const cell4 = document.createElement('td');
    //            cell4.textContent = data[i].status;
    //            row.ap    pendChild(cell4);

   // const cell5 = document.createElement('td');
   //cell5.innerHTML = `   
   // <span class="three-dots" onclick="toggleDropdown(event)">
   //     <img src="/Content/img/ri_more-2-fill.png" alt="3-dot" class="icon-dot">
   // </span>
   // <ul class="dropdown-menu" style="display: none;">
   //     <li>
   //         <a href="#" class="edit-option" onclick="openEditPanel(${data[i].MaNhanVien})">
   //             <span>Sửa</span>
   //         </a>
   //     </li>
   //     <li>
   //         <a href="#" class="delete-option">
   //             <span>Xóa</span>
   //         </a>
   //     </li>
   // </ul>`;

    //row.appendChild(cell5);

    //tableBody.appendChild(row);
    //        }
    //    }
    //}
    document.querySelectorAll('.edit-option').forEach(editButton => {
        editButton.addEventListener('click', function () {
            const maNhanVien = this.getAttribute('data-id');
            openEditPanel(maNhanVien);  // gọi hàm với maNhanVien từ thuộc tính data-id
        });
    });
    function toggleDropdown(event) {
        event.stopPropagation(); // Prevent the event from propagating to the document
        const dropdownToggle = event.target.closest('.three-dots');
        const dropdownMenu = dropdownToggle ? dropdownToggle.nextElementSibling : null;

        if (dropdownMenu && dropdownMenu.classList.contains('dropdown-menu')) {
            const allDropdowns = document.querySelectorAll('.dropdown-menu');
            allDropdowns.forEach(menu => {
                if (menu !== dropdownMenu) {
                    menu.style.display = 'none'; // Close other dropdowns
                }
            });

            // Toggle the clicked dropdown
            dropdownMenu.style.display = dropdownMenu.style.display === 'none' ? 'block' : 'none';
        }
    }


    // Hide dropdown when clicking outside
    document.addEventListener('click', function (event) {
        const dropdownMenus = document.querySelectorAll('.dropdown-menu');
        dropdownMenus.forEach(menu => {
            if (!menu.contains(event.target) && !event.target.closest('.three-dots')) {
                menu.style.display = 'none';
            }
        });
    });

    // Hide dropdown when selecting an option
    $(document).on('click', '.edit-option, .delete-option', function () {
        $('.dropdown-menu').hide();
    });

    //document.addEventListener('DOMContentLoaded', function () {
    //    renderTable(data);
    //});

    //datetimepicker
    $(document).ready(function () {
        $(".datetime-icon").on("click", function () {
            var inputField = $(this).prev('input');


            inputField.datepicker('show');
        });

        // Khởi tạo datepicker cho các ô nhập liệu
        $('#ngaysinh').datepicker({
            format: 'dd/mm/yyyy',
            autoclose: true
        });

        $('#ngayvaolam').datepicker({
            format: 'dd/mm/yyyy',
            autoclose: true
        });
    });
    $(document).ready(function () {

        var today = new Date();


        var day = today.getDate();
        var month = today.getMonth() + 1;
        var year = today.getFullYear();


        day = day < 10 ? '0' + day : day;
        month = month < 10 ? '0' + month : month;


        var formattedDate = day + '/' + month + '/' + year;


        $('#ngaysinh').val(formattedDate);
        $('#ngayvaolam').val(formattedDate);
    });


    //form-panel
    function openEditPanel(maNhanVien) {
        // Tìm nhân viên dựa trên maNhanVien
        const nhanVien = Model.DanhSachNhanVien.find(nv => nv.MaNhanVien == maNhanVien);

        // Kiểm tra nếu tìm thấy nhân viên và tải dữ liệu vào form
        if (nhanVien) {
            loadUpdateForm(nhanVien);
            const rightPanel = document.getElementById('rightPanel');
            if (rightPanel) {
                rightPanel.classList.add('show');  // Hiển thị form sửa
                document.querySelector('.main-section').classList.add('panel-active');
            }
        }
    }

    document.addEventListener('DOMContentLoaded', function () {

        const formPanel = document.getElementById('formPanel');
        const mainContent = document.querySelector('.main-section');
        const closePanelButton = document.getElementById("closePanel1");


       


        function updatePanelHeight() {
            const mainSectionHeight = mainContent.offsetHeight;
            formPanel.style.height = `${mainSectionHeight}px`;
        }

        const editButton = document.querySelector('.edit-option');
        if (editButton) {
            editButton.addEventListener('click', openEditPanel);
        } else {
            console.error('Nút sửa không tìm thấy!');
        }
  


        closePanelButton.addEventListener("click", function () {
            console.log("Đang đóng form...");
            formPanel.classList.remove("show");
            mainContent.classList.remove("panel-active");
        });


        document.querySelector('.btn-save').addEventListener('click', () => {
            alert('Lưu thành công!');
        });


        document.querySelector('.btn-delete').addEventListener('click', () => {
            alert('Đã xóa!');
        });
    });
    function loadUpdateForm(nhanVien) {
        document.getElementById("updateMaNhanVien").value = nhanVien.MaNhanVien || '';
        document.getElementById("updateHoTen").value = nhanVien.HoTen || '';
        document.getElementById("updateMaPhongBan").value = nhanVien.MaPhongBan || '';
        document.getElementById("updateMaTrinhDo").value = nhanVien.MaTrinhDo || '';
        document.getElementById("updateMaChucVu").value = nhanVien.MaChucVu || '';
        document.getElementById("updateCCCD").value = nhanVien.CCCD || '';
        document.getElementById("updateNgaySinh").value = nhanVien.NgaySinh || '';
        document.getElementById("updateGioiTinh").value = nhanVien.GioiTinh || '';
        document.getElementById("updateDiaChi").value = nhanVien.DiaChi || '';
        document.getElementById("updateEmail").value = nhanVien.Email || '';
        document.getElementById("updateSoDienThoai").value = nhanVien.SoDienThoai || '';
        document.getElementById("updateNgayBatDauLam").value = nhanVien.NgayBatDauLam || '';
        document.getElementById("updateTenTaiKhoan").value = nhanVien.TenTaiKhoan || '';
    }



</script>